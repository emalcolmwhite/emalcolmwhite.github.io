<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">

<head>

<meta charset="utf-8" />
<meta name="generator" content="quarto-1.3.450" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

<meta name="author" content="Emily Malcolm-White" />

<title>EMW ‚Äì Webscraping Tables</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<!-- htmldependencies:E3FAD763 -->
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  
  <script>
    (function () {
      var script = document.createElement("script");
      script.type = "text/javascript";
      script.src  = "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js";
      document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>


<link rel="stylesheet" href="../../styles/custom.css" />
</head>

<body>


<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="/index.html">
    <span class="navbar-title">EMW</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse"
  aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation"
  onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="/courses/stat0118/index.html" rel="" target="">
 <span class="menu-text">STAT 118: Data Science</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="/courses/stat0116/index.html" rel="" target="">
 <span class="menu-text">STAT 116: Stats</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="/courses/r-by-the-sea/index.html" rel="" target="">
 <span class="menu-text">R by the Sea</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="mailto:emalcolmwhite@middlebury.edu" rel="" target=""><i 
  class="bi bi-envelope" 
  role="img" 
>
</i> 
 <span class="menu-text">Email</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn"
      data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" 
      aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
      onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <h1 class="quarto-secondary-nav-title"></h1>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" 
      aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation"
      onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="/index.html" class="sidebar-logo-link">
      <img src="/courses/stat0118/images/stat0118_hex_sticker.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none"/>
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">STAT 118 Home</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">üöÄ <b> Getting Started </b></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_A_intro_quarto.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">R & RStudio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_A_intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quarto & Markdown</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">üõ†Ô∏è <b> Data Wrangling</b> </span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_B_wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Wrangling with `dplyr`</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_C_aggregating.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Aggregating Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_I_joining.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Joining Tables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_J_pivoting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pivoting with `tidyr`</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">üìä <b> Visualization</b></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_D_ggplot.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Barplots and Scatterplots</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_E_ggplot_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Histograms, Boxplots, Linegraphs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_F_ggplot_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Customizing Plots: `scales`</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">üß∞ <b> Specialized Tools </b></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_H_forcats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Categorical Data: `forcats`</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_Q_stringr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Text: `stringr`</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_R_lubridate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Date-Time Data: `lubridate`</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_janitor.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Cleaning: `janitor`</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_gganimate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Animated Plots: `gganimate`</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">üó∫Ô∏è  <b> Maps </b></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_G_maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Chlorepleth Maps</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_L_Maps2.qmd" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Points on Maps</span></a>
  </div>
</li>
        <li class="sidebar-item">
 <span class="menu-text">üåêÔ∏è <b>  Webscraping</b></span>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_O_webscraping_tables.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">tables</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="/courses/stat0118/118_P_webscraping_text.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">text</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" ></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <div id="quarto-toc-target"></div>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Webscraping Tables</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Emily Malcolm-White </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>
<nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#obtaining-data-from-the-web" id="toc-obtaining-data-from-the-web">Obtaining Data From The Web</a></li>
  <li><a href="#stop-should-we-be-scraping-this-data" id="toc-stop-should-we-be-scraping-this-data">STOP: Should we be scraping this data?</a></li>
  <li><a href="#first-a-bit-about-html-code-and-html-tables" id="toc-first-a-bit-about-html-code-and-html-tables">First, a bit about html code and html tables</a>
  <ul>
  <li><a href="#basics-of-html" id="toc-basics-of-html">Basics of HTML</a></li>
  <li><a href="#html-tables" id="toc-html-tables">HTML Tables</a></li>
  <li><a href="#html-class" id="toc-html-class">HTML class</a></li>
  </ul></li>
  <li><a href="#web-scraping-using-rvest" id="toc-web-scraping-using-rvest">Web Scraping using <code>rvest</code></a>
  <ul>
  <li><a href="#viewing-raw-html-from-a-website" id="toc-viewing-raw-html-from-a-website">Viewing Raw HTML from a website</a></li>
  <li><a href="#webscraping-tables-from-wikipedia" id="toc-webscraping-tables-from-wikipedia">Webscraping Tables from Wikipedia</a></li>
  <li><a href="#cleaning-up-with-janitor" id="toc-cleaning-up-with-janitor">Cleaning up with <code>janitor</code></a></li>
  </ul></li>
  </ul>
</nav>
<p><img src="https://rvest.tidyverse.org/logo.png" class="img-fluid" style="width:30.0%" /></p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#LOAD PACKAGES </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
</div>
<p>Data doesn‚Äôt just magically appear on your computer you need to get it from somewhere.</p>
<p>Often times, we download data (.csv files or other) and save it locally on our computer.</p>
<p>Other times, we download it from R packages (like we did with the gapminder dataset).</p>
<section id="obtaining-data-from-the-web" class="level1">
<h1>Obtaining Data From The Web</h1>
<p>For example, maybe we are interested in renting an apartment or house in Vermont (or studying the rental market in Vermont). You might navigate to Craigslist to get some information: <a href="https://vermont.craigslist.org/search/apa">https://vermont.craigslist.org/search/apa</a></p>
<p>We could spend many hours writing down and creating a spreadsheet with the information about each available apartment‚Ä¶ or‚Ä¶</p>
<p>When you enter a URL into your browser, your browser connects to the web server at that URL and asks for the <em>source code</em> for that website. We can view the source code in a web brower by clicking on <em>view source</em>.</p>
<p>Web scraping is a process by which we can use R (or other software) to systematically go through the source code to extract content and data.</p>
</section>
<section id="stop-should-we-be-scraping-this-data" class="level1">
<h1>STOP: Should we be scraping this data?</h1>
<p><em>Before</em> scraping data from the web, you should always check whether or not you <em>should</em> scrape it.</p>
<p><em>Is it legal?</em> <em>Can your specific use case violate the rules?</em> <em>Even if legal, is it ethical?</em></p>
<p>In the US, publicly available information on the web is legal as long as the scraped data is not:</p>
<ul>
<li>used for any harmful purpose</li>
<li>used to directly harm the scraped website‚Äôs business of operations</li>
<li>including personally identifiable information (PII)</li>
</ul>
<p>There are some very interesting cases which help to define the above precedent that you might want to read about: <a href="https://en.wikipedia.org/wiki/EBay_v._Bidder&#39;s_Edge#Order">eBay vs.¬†Bidder‚Äôs Edge (2000)</a>, <a href="https://en.wikipedia.org/wiki/Facebook,_Inc._v._Power_Ventures,_Inc.#Ruling">Facebook vs.¬†Power Venures (2009)</a> and <a href="https://en.wikipedia.org/wiki/HiQ_Labs_v._LinkedIn">Linkedin vs.¬†hiQ Labs (2019)</a></p>
<p>Websites sometimes outline the use of webscraping in their Terms of Use. There are two places you can look: the <code>robots.txt</code> file and the Terms of Service Document. For example, in the the Craigslist terms of service document, we find the following text <em>‚ÄúYou agree not to copy/collect CL content via robots, spiders, scripts, scrapers, crawlers, or any automated or manual equivalent (e.g.¬†by hand).</em> Wikipedia on the other hand, doesn‚Äôt explicit state that web scraping is disallowed so I will encourage us to use that website for many of our examples this week.</p>
</section>
<section id="first-a-bit-about-html-code-and-html-tables" class="level1">
<h1>First, a bit about html code and html tables</h1>
<section id="basics-of-html" class="level2">
<h2>Basics of HTML</h2>
<ul>
<li>HTML stands for Hyper Text Markup Language and is the standard markup language for creating webpages</li>
<li>HTML code consists of a series of elements</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Typically, an HTML element is defined by a start tag, some content, and an end tag</p>
<p><code>&lt;tagname&gt; ...some content here... &lt;/tagname&gt;</code></p>
</div>
</div>
<p>For example:</p>
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Page Title&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;h1&gt;My First Heading&lt;/h1&gt;
&lt;p&gt;My first paragraph.&lt;/p&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>There are many, many different possible tag elements. In this class, it‚Äôs not important that you know the specifics of what each element is. It‚Äôs useful for you to understand the basic structure.</p>
</section>
<section id="html-tables" class="level2">
<h2>HTML Tables</h2>
<p>An HTML table is used to represent data in a structured way</p>
<ul>
<li><code>&lt;table&gt;</code> Defines a table</li>
<li><code>&lt;th&gt;</code> Defines a header cell in a table</li>
<li><code>&lt;tr&gt;</code> Defines a row in a table</li>
<li><code>&lt;td&gt;</code> Defines a cell in a table</li>
</ul>
<p>Here is the HTML code:</p>
<pre><code>&lt;table&gt;
  &lt;tr&gt;
    &lt;th&gt;Name&lt;/th&gt;
    &lt;th&gt;Birth Year&lt;/th&gt;  
    &lt;th&gt;Country&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Harry Styles&lt;/td&gt;
    &lt;td&gt;Feb 1, 1994&lt;/td&gt;
    &lt;td&gt;Britain&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Taylor Swift&lt;/td&gt;
    &lt;td&gt;Dec 13, 1989&lt;/td&gt;
    &lt;td&gt;USA&lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;Justin Bieber&lt;/td&gt;
    &lt;td&gt;Mar 1, 1994&lt;/td&gt;
    &lt;td&gt;Canada&lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt;</code></pre>
<p>Here is how the HTML displays in a web browser:</p>

<table>
<tr>
<th>
Name
</th>
<th>
Birth Year
</th>
<th>
Country
</th>
</tr>
<tr>
<td>
Harry Styles
</td>
<td>
Feb 1, 1994
</td>
<td>
Britain
</td>
</tr>
<tr>
<td>
Taylor Swift
</td>
<td>
Dec 13, 1989
</td>
<td>
USA
</td>
</tr>
<tr>
<td>
Justin Bieber
</td>
<td>
Mar 1, 1994
</td>
<td>
Canada
</td>
</tr>

</table>
<p>Today‚Äôs class will focus on scraping data from HTML tables!</p>
</section>
<section id="html-class" class="level2">
<h2>HTML class</h2>
<p>The <code>class</code> attribute can be added to any HTML element. Often it is used to help customize the styling of the element (among other things).</p>
<pre><code>&lt;h2 class=&quot;city&quot;&gt;Middlebury&lt;/h2&gt;
&lt;p class=&quot;city&quot;&gt;Middlebury is a town in Vermont&lt;/p&gt;</code></pre>
<p>This can be particularly useful in web scraping ‚Äì we can ask to scrape particular elements, particular classes, or both!</p>
</section>
</section>
<section id="web-scraping-using-rvest" class="level1">
<h1>Web Scraping using <code>rvest</code></h1>
<p>We need the package <a href="https://rvest.tidyverse.org/"><code>rvest</code></a> to help us with this.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code></pre></div>
</div>
<section id="viewing-raw-html-from-a-website" class="level2">
<h2>Viewing Raw HTML from a website</h2>
<p>You can inspect the source code of any webpage by using a web browser like Firefox or Chrome.</p>
<ul>
<li>On Firefox, navigate to the ‚ÄúTools‚Äù menu item in the top menu and click on ‚ÄúWeb Developer/Page Source‚Äù. You can also use the shortcut <code>Command + U</code></li>
<li>On Chrome, navigate to the top menu item ‚ÄúView‚Äù and click on ‚ÄúDeveloper/View Source.‚Äù You can also use the keyboard shortcut <code>Option-Command-U</code>. It also can be useful to use the <a href="https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb/related">SelectorGadget Extension</a>.</li>
</ul>
</section>
<section id="webscraping-tables-from-wikipedia" class="level2">
<h2>Webscraping Tables from Wikipedia</h2>
<p>Check out the information on the (List of the Most Viewed YouTube Videos on Wikipedia)[https://en.wikipedia.org/wiki/List_of_most-viewed_YouTube_videos]. Suppose we want to scrape this data to use in R.</p>
<ul>
<li><code>read_html</code> scrapes the raw html from the webpage as text</li>
<li><code>html_element</code> (and <code>html_elements</code>) selects particular elements from the HTML code</li>
<li><code>html_table</code> formats a scraped html table as a tibble (R table)</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>youtube_videos <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_most-viewed_YouTube_videos&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">&quot;.wikitable&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>youtube_videos</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 31 √ó 6
   `Video name`                    Uploader `Views (billions)` Date  Notes ``   
   &lt;chr&gt;                           &lt;chr&gt;    &lt;chr&gt;              &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 Baby Shark Dance[7]             Pinkfon‚Ä¶ 15.62              June‚Ä¶ &quot;[A]&quot; &lt;NA&gt; 
 2 Despacito[10]                   Luis Fo‚Ä¶ 8.65               Janu‚Ä¶ &quot;[B]&quot; &lt;NA&gt; 
 3 Wheels on the Bus[18]           Cocomel‚Ä¶ 7.13               May ‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 4 Johny Johny Yes Papa[19]        LooLoo ‚Ä¶ 7.01               Octo‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 5 Bath Song[20]                   Cocomel‚Ä¶ 7.00               May ‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 6 See You Again[21]               Wiz Kha‚Ä¶ 6.57               Apri‚Ä¶ &quot;[C]&quot; &lt;NA&gt; 
 7 Shape of You[26]                Ed Shee‚Ä¶ 6.41               Janu‚Ä¶ &quot;[D]&quot; &lt;NA&gt; 
 8 Phonics Song with Two Words[29] ChuChu ‚Ä¶ 6.29               Marc‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 9 Uptown Funk[30]                 Mark Ro‚Ä¶ 5.48               Nove‚Ä¶ &quot;&quot;    &lt;NA&gt; 
10 Gangnam Style[31]               Psy      5.47               July‚Ä¶ &quot;[E]&quot; &lt;NA&gt; 
# ‚Ñπ 21 more rows</code></pre>
</div>
</div>
<ul>
<li><p>We could have used <code>html_element("table")</code> If we did this, it would have pulled the first <code>&lt;table&gt;</code> from the page.</p></li>
<li><p>We could have used <code>html_elements("table")</code> If we did this, it would have pulled all the <code>&lt;table&gt;</code> elements from the page.</p></li>
<li><p>If you want a specific table that isn‚Äôt the first table, scrape all the tables and apply <code>html_table()</code>. Then take that new object of the tables and add <code>[[n]]</code> to get the <span class="math inline">\(n^{th}\)</span> table. For example to call the <span class="math inline">\(2^{nd}\)</span> table,</p></li>
</ul>
<pre><code>tables &lt;- html %&gt;% 
  html_elements(&quot;table&quot;) %&gt;%
  html_table() 
  
tables[[2]]</code></pre>
<ul>
<li>In this case, we used <code>html_elements(".wikitable")</code> I choose to use this because the <code>&lt;table&gt;</code> was also defined with a unique <code>class</code>: <code>&lt;table class="wikitable sortable"&gt;</code></li>
</ul>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon'></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note that if we are using <code>html_element</code> to call a class, it is important to add a ‚Äú<code>.</code>‚Äù before the class element name. You do not need to do this is you are calling an HTML element (like ‚Äútable‚Äù)</p>
</div>
</div>
</section>
<section id="cleaning-up-with-janitor" class="level2">
<h2>Cleaning up with <code>janitor</code></h2>
<p>Web scraping doesn‚Äôt always format perfectly. Let‚Äôs clean it up!</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img src="https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/79a12c01-0cc1-4643-b1e7-8ce8cafc947b_rw_1920.png?h=a3760f3882e735d7065627fc060714ce" class="img-fluid" style="width:50.0%" /></p>
<figcaption>Artwork by <span class="citation" data-cites="allisonhorst">@allisonhorst</span></figcaption>
</figure>
</div>
<p>Clean up the names of the header:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>youtube_videos <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(youtube_videos)</span></code></pre></div>
</div>
<p>Remove the last row:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># youtube_videos &lt;- youtube_videos %&gt;% </span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(no != &quot;As of August 8, 2023&quot;)</span></span></code></pre></div>
</div>
<p>Format the views as a number using <code>as.numeric</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>youtube_videos <span class="ot">&lt;-</span> youtube_videos <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">views_billions =</span> <span class="fu">as.numeric</span>(views_billions))</span></code></pre></div>
</div>
<p>What are the top 10 most viewed YouTube Videos?</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> youtube_videos <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(views_billions)) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>top10</span></code></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 6
   video_name                      uploader     views_billions date  notes x    
   &lt;chr&gt;                           &lt;chr&gt;                 &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 Baby Shark Dance[7]             Pinkfong Ba‚Ä¶          15.6  June‚Ä¶ &quot;[A]&quot; &lt;NA&gt; 
 2 Despacito[10]                   Luis Fonsi             8.65 Janu‚Ä¶ &quot;[B]&quot; &lt;NA&gt; 
 3 Wheels on the Bus[18]           Cocomelon -‚Ä¶           7.13 May ‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 4 Johny Johny Yes Papa[19]        LooLoo Kids‚Ä¶           7.01 Octo‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 5 Bath Song[20]                   Cocomelon -‚Ä¶           7    May ‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 6 See You Again[21]               Wiz Khalifa            6.57 Apri‚Ä¶ &quot;[C]&quot; &lt;NA&gt; 
 7 Shape of You[26]                Ed Sheeran             6.41 Janu‚Ä¶ &quot;[D]&quot; &lt;NA&gt; 
 8 Phonics Song with Two Words[29] ChuChu TV N‚Ä¶           6.29 Marc‚Ä¶ &quot;&quot;    &lt;NA&gt; 
 9 Uptown Funk[30]                 Mark Ronson            5.48 Nove‚Ä¶ &quot;&quot;    &lt;NA&gt; 
10 Gangnam Style[31]               Psy                    5.47 July‚Ä¶ &quot;[E]&quot; &lt;NA&gt; </code></pre>
</div>
</div>
<p>Once we have this data, we can make cool plots!</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>top10 <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>views_billions, <span class="at">y=</span><span class="fu">reorder</span>(video_name, views_billions))) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Views (in billions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Videos&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Top 10 Most Watched YouTube Videos of All Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="118_O_webscraping_tables_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<p>:::callout-tip In this case, the list of the names is still not displaying very neatly. For example, rather than <code>"Baby Shark Dance"[6]</code> I might want it to just say <code>Baby Shark Dance</code>.</p>
<p>We can use the <code>stringr</code> package to remove symbols and numbers from the video names. We will be talking more about <code>stringr</code> later this semester and it‚Äôs not something I expect you to be able to do at this point in the semester.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="sourceCode r cell-code"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>top10 <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">video_name=</span><span class="fu">str_replace_all</span>(video_name, <span class="st">&quot;[^[:alpha:]]&quot;</span>, <span class="st">&quot; &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>views_billions, <span class="at">y=</span><span class="fu">reorder</span>(video_name, views_billions))) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Views (in billions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Videos&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Top 10 Most Watched YouTube Videos of All Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="cell-output-display">
<p><img src="118_O_webscraping_tables_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672" /></p>
</div>
</div>
<div class="callout callout-style-simple callout-none no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class='callout-icon no-icon'></i>
</div>
<div class="callout-title-container flex-fill">
External Resources
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://r4ds.hadley.nz/webscraping">R for Data Science, Webscraping</a></li>
</ul>
</div>
</div>
<div id="quarto-navigation-envelope" class="hidden">
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">STAT 118: Intro to Data Science</span> <span class="hidden" data-render-id="quarto-int-navbar-title">EMW</span> <span class="hidden" data-render-id="quarto-int-next">text</span> <span class="hidden" data-render-id="quarto-int-prev">Points on Maps</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/index.html">STAT 118 Home</span> <span class="hidden" data-render-id="quarto-int-sidebar:undefined">üåêÔ∏è <b> Webscraping</b></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_A_intro_quarto.html">R &amp; RStudio</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_A_intro.html">Quarto &amp; Markdown</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_B_wrangling.html">Wrangling with <code>dplyr</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_C_aggregating.html">Aggregating Data</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_I_joining.html">Joining Tables</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_J_pivoting.html">Pivoting with <code>tidyr</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_D_ggplot.html">Barplots and Scatterplots</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_E_ggplot_2.html">Histograms, Boxplots, Linegraphs</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_F_ggplot_3.html">Customizing Plots: <code>scales</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_H_forcats.html">Categorical Data: <code>forcats</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_Q_stringr.html">Working with Text: <code>stringr</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_R_lubridate.html">Date-Time Data: <code>lubridate</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_janitor.html">Data Cleaning: <code>janitor</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_gganimate.html">Animated Plots: <code>gganimate</code></span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_G_maps.html">Chlorepleth Maps</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_L_Maps2.qmd">Points on Maps</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_O_webscraping_tables.html">tables</span> <span class="hidden" data-render-id="quarto-int-sidebar:/courses/stat0118/118_P_webscraping_text.html">text</span> <span class="hidden" data-render-id="quarto-int-navbar:STAT 118: Data Science">STAT 118: Data Science</span> <span class="hidden" data-render-id="quarto-int-navbar:/courses/stat0118/index.html">/courses/stat0118/index.html</span> <span class="hidden" data-render-id="quarto-int-navbar:STAT 116: Stats">STAT 116: Stats</span> <span class="hidden" data-render-id="quarto-int-navbar:/courses/stat0116/index.html">/courses/stat0116/index.html</span> <span class="hidden" data-render-id="quarto-int-navbar:R by the Sea">R by the Sea</span> <span class="hidden" data-render-id="quarto-int-navbar:/courses/r-by-the-sea/index.html">/courses/r-by-the-sea/index.html</span> <span class="hidden" data-render-id="quarto-int-navbar:Email">Email</span> <span class="hidden" data-render-id="quarto-int-navbar:mailto:emalcolmwhite@middlebury.edu">mailto:emalcolmwhite@middlebury.edu</span> <span class="hidden" data-render-id="quarto-breadcrumbs-9ab2ec7ea4a2041306f7bdf150fcd453">tables</span></p>
</div>
<div id="quarto-meta-markdown" class="hidden">
<p><span class="hidden" data-render-id="quarto-metatitle">EMW - Webscraping Tables</span> <span class="hidden" data-render-id="quarto-twittercardtitle">EMW - Webscraping Tables</span> <span class="hidden" data-render-id="quarto-ogcardtitle">EMW - Webscraping Tables</span> <span class="hidden" data-render-id="quarto-metasitename">EMW</span> <span class="hidden" data-render-id="quarto-twittercarddesc"></span> <span class="hidden" data-render-id="quarto-ogcardddesc"></span></p>
</div>
<!-- -->
<div class="quarto-embedded-source-code">
<div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode markdown"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> &#39;Webscraping Tables&#39;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> &#39;Emily Malcolm-White&#39;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html: </span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: TRUE</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resources: true</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools:</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">      source: true</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">      toggle: false</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co">      caption: none</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co">    code-annotations: hover</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co">  pdf: default</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">  message: FALSE</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: FALSE</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="al">![](https://rvest.tidyverse.org/logo.png)</span>{width=30%}</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#LOAD PACKAGES </span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>Data doesn&#39;t just magically appear on your computer you need to get it from somewhere. </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>Often times, we download data (.csv files or other) and save it locally on our computer. </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>Other times, we download it from R packages (like we did with the gapminder dataset). </span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="fu"># Obtaining Data From The Web</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>For example, maybe we are interested in renting an apartment or house in Vermont (or studying the rental market in Vermont). You might navigate to Craigslist to get some information: <span class="co">[</span><span class="ot">https://vermont.craigslist.org/search/apa</span><span class="co">](https://vermont.craigslist.org/search/apa)</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>We could spend many hours writing down and creating a spreadsheet with the information about each available apartment... or... </span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>When you enter a URL into your browser, your browser connects to the web server at that URL and asks for the *source code* for that website. We can view the source code in a web brower by clicking on *view source*. </span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>Web scraping is a process by which we can use R (or other software) to systematically go through the source code to extract content and data. </span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="fu"># STOP: Should we be scraping this data? </span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>*Before* scraping data from the web, you should always check whether or not you *should* scrape it.</span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>*Is it legal?*</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>*Can your specific use case violate the rules?*</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>*Even if legal, is it ethical?*</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>In the US, publicly available information on the web is legal as long as the scraped data is not:  </span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>used for any harmful purpose</span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>used to directly harm the scraped website&#39;s business of operations</span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>including personally identifiable information (PII)</span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>There are some very interesting cases which help to define the above precedent that you might want to read about: <span class="co">[</span><span class="ot">eBay vs. Bidder&#39;s Edge (2000)</span><span class="co">](https://en.wikipedia.org/wiki/EBay_v._Bidder&#39;s_Edge#Order)</span>, <span class="co">[</span><span class="ot">Facebook vs. Power Venures (2009)</span><span class="co">](https://en.wikipedia.org/wiki/Facebook,_Inc._v._Power_Ventures,_Inc.#Ruling)</span> and <span class="co">[</span><span class="ot">Linkedin vs. hiQ Labs (2019)</span><span class="co">](https://en.wikipedia.org/wiki/HiQ_Labs_v._LinkedIn)</span></span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>Websites sometimes outline the use of webscraping in their Terms of Use. There are two places you can look: the <span class="in">`robots.txt`</span> file and the Terms of Service Document. For example, in the the Craigslist terms of service document, we find the following text *&quot;You agree not to copy/collect CL content via robots, spiders, scripts, scrapers, crawlers, or any automated or manual equivalent (e.g. by hand).* Wikipedia on the other hand, doesn&#39;t explicit state that web scraping is disallowed so I will encourage us to use that website for many of our examples this week. </span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a><span class="fu"># First, a bit about html code and html tables</span></span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Basics of HTML</span></span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>HTML stands for Hyper Text Markup Language and is the standard markup language for creating webpages</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>HTML code consists of a series of elements </span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>:::callout-tip</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>Typically, an HTML element is defined by a start tag, some content, and an end tag</span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a><span class="in">`&lt;tagname&gt; ...some content here... &lt;/tagname&gt;`</span></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>For example: </span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a><span class="in">```{}</span></span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;html&gt;</span></span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;head&gt;</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;title&gt;Page Title&lt;/title&gt;</span></span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/head&gt;</span></span>
<span id="cb17-81"><a href="#cb17-81" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;body&gt;</span></span>
<span id="cb17-82"><a href="#cb17-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-83"><a href="#cb17-83" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;h1&gt;My First Heading&lt;/h1&gt;</span></span>
<span id="cb17-84"><a href="#cb17-84" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;p&gt;My first paragraph.&lt;/p&gt;</span></span>
<span id="cb17-85"><a href="#cb17-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-86"><a href="#cb17-86" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/body&gt;</span></span>
<span id="cb17-87"><a href="#cb17-87" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/html&gt;</span></span>
<span id="cb17-88"><a href="#cb17-88" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-89"><a href="#cb17-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-90"><a href="#cb17-90" aria-hidden="true" tabindex="-1"></a>There are many, many different possible tag elements. In this class, it&#39;s not important that you know the specifics of what each element is. It&#39;s useful for you to understand the basic structure.  </span>
<span id="cb17-91"><a href="#cb17-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-92"><a href="#cb17-92" aria-hidden="true" tabindex="-1"></a><span class="fu">## HTML Tables</span></span>
<span id="cb17-93"><a href="#cb17-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-94"><a href="#cb17-94" aria-hidden="true" tabindex="-1"></a>An HTML table is used to represent data in a structured way</span>
<span id="cb17-95"><a href="#cb17-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-96"><a href="#cb17-96" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`&lt;table&gt;`</span> Defines a table</span>
<span id="cb17-97"><a href="#cb17-97" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`&lt;th&gt;`</span>    Defines a header cell in a table</span>
<span id="cb17-98"><a href="#cb17-98" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`&lt;tr&gt;`</span>    Defines a row in a table</span>
<span id="cb17-99"><a href="#cb17-99" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`&lt;td&gt;`</span>    Defines a cell in a table</span>
<span id="cb17-100"><a href="#cb17-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-101"><a href="#cb17-101" aria-hidden="true" tabindex="-1"></a>Here is the HTML code: </span>
<span id="cb17-102"><a href="#cb17-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-103"><a href="#cb17-103" aria-hidden="true" tabindex="-1"></a><span class="in">```{}</span></span>
<span id="cb17-104"><a href="#cb17-104" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;table&gt;</span></span>
<span id="cb17-105"><a href="#cb17-105" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;tr&gt;</span></span>
<span id="cb17-106"><a href="#cb17-106" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;th&gt;Name&lt;/th&gt;</span></span>
<span id="cb17-107"><a href="#cb17-107" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;th&gt;Birth Year&lt;/th&gt;  </span></span>
<span id="cb17-108"><a href="#cb17-108" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;th&gt;Country&lt;/th&gt;</span></span>
<span id="cb17-109"><a href="#cb17-109" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;/tr&gt;</span></span>
<span id="cb17-110"><a href="#cb17-110" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;tr&gt;</span></span>
<span id="cb17-111"><a href="#cb17-111" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Harry Styles&lt;/td&gt;</span></span>
<span id="cb17-112"><a href="#cb17-112" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Feb 1, 1994&lt;/td&gt;</span></span>
<span id="cb17-113"><a href="#cb17-113" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Britain&lt;/td&gt;</span></span>
<span id="cb17-114"><a href="#cb17-114" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;/tr&gt;</span></span>
<span id="cb17-115"><a href="#cb17-115" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;tr&gt;</span></span>
<span id="cb17-116"><a href="#cb17-116" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Taylor Swift&lt;/td&gt;</span></span>
<span id="cb17-117"><a href="#cb17-117" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Dec 13, 1989&lt;/td&gt;</span></span>
<span id="cb17-118"><a href="#cb17-118" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;USA&lt;/td&gt;</span></span>
<span id="cb17-119"><a href="#cb17-119" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;/tr&gt;</span></span>
<span id="cb17-120"><a href="#cb17-120" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;tr&gt;</span></span>
<span id="cb17-121"><a href="#cb17-121" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Justin Bieber&lt;/td&gt;</span></span>
<span id="cb17-122"><a href="#cb17-122" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Mar 1, 1994&lt;/td&gt;</span></span>
<span id="cb17-123"><a href="#cb17-123" aria-hidden="true" tabindex="-1"></a><span class="in">    &lt;td&gt;Canada&lt;/td&gt;</span></span>
<span id="cb17-124"><a href="#cb17-124" aria-hidden="true" tabindex="-1"></a><span class="in">  &lt;/tr&gt;</span></span>
<span id="cb17-125"><a href="#cb17-125" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/table&gt;</span></span>
<span id="cb17-126"><a href="#cb17-126" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-127"><a href="#cb17-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-128"><a href="#cb17-128" aria-hidden="true" tabindex="-1"></a>Here is how the HTML displays in a web browser: </span>
<span id="cb17-129"><a href="#cb17-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-130"><a href="#cb17-130" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;table&gt;</span></span>
<span id="cb17-131"><a href="#cb17-131" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb17-132"><a href="#cb17-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;th&gt;</span>Name<span class="kw">&lt;/th&gt;</span></span>
<span id="cb17-133"><a href="#cb17-133" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;th&gt;</span>Birth Year<span class="kw">&lt;/th&gt;</span>  </span>
<span id="cb17-134"><a href="#cb17-134" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;th&gt;</span>Country<span class="kw">&lt;/th&gt;</span></span>
<span id="cb17-135"><a href="#cb17-135" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb17-136"><a href="#cb17-136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb17-137"><a href="#cb17-137" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Harry Styles<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-138"><a href="#cb17-138" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Feb 1, 1994<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-139"><a href="#cb17-139" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Britain<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-140"><a href="#cb17-140" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb17-141"><a href="#cb17-141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb17-142"><a href="#cb17-142" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Taylor Swift<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-143"><a href="#cb17-143" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Dec 13, 1989<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-144"><a href="#cb17-144" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>USA<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-145"><a href="#cb17-145" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb17-146"><a href="#cb17-146" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;tr&gt;</span></span>
<span id="cb17-147"><a href="#cb17-147" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Justin Bieber<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-148"><a href="#cb17-148" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Mar 1, 1994<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-149"><a href="#cb17-149" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;td&gt;</span>Canada<span class="kw">&lt;/td&gt;</span></span>
<span id="cb17-150"><a href="#cb17-150" aria-hidden="true" tabindex="-1"></a>  <span class="kw">&lt;/tr&gt;</span></span>
<span id="cb17-151"><a href="#cb17-151" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/table&gt;</span></span>
<span id="cb17-152"><a href="#cb17-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-153"><a href="#cb17-153" aria-hidden="true" tabindex="-1"></a>Today&#39;s class will focus on scraping data from HTML tables! </span>
<span id="cb17-154"><a href="#cb17-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-155"><a href="#cb17-155" aria-hidden="true" tabindex="-1"></a><span class="fu">## HTML class</span></span>
<span id="cb17-156"><a href="#cb17-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-157"><a href="#cb17-157" aria-hidden="true" tabindex="-1"></a>The <span class="in">`class`</span> attribute can be added to any HTML element. Often it is used to help customize the styling of the element (among other things). </span>
<span id="cb17-158"><a href="#cb17-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-159"><a href="#cb17-159" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-160"><a href="#cb17-160" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;h2 class=&quot;city&quot;&gt;Middlebury&lt;/h2&gt;</span></span>
<span id="cb17-161"><a href="#cb17-161" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;p class=&quot;city&quot;&gt;Middlebury is a town in Vermont&lt;/p&gt;</span></span>
<span id="cb17-162"><a href="#cb17-162" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-163"><a href="#cb17-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-164"><a href="#cb17-164" aria-hidden="true" tabindex="-1"></a>This can be particularly useful in web scraping -- we can ask to scrape particular elements, particular classes, or both!</span>
<span id="cb17-165"><a href="#cb17-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-166"><a href="#cb17-166" aria-hidden="true" tabindex="-1"></a><span class="fu"># Web Scraping using `rvest`</span></span>
<span id="cb17-167"><a href="#cb17-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-168"><a href="#cb17-168" aria-hidden="true" tabindex="-1"></a>We need the package <span class="co">[</span><span class="ot">`rvest`</span><span class="co">](https://rvest.tidyverse.org/)</span> to help us with this.</span>
<span id="cb17-169"><a href="#cb17-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-170"><a href="#cb17-170" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb17-171"><a href="#cb17-171" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span>
<span id="cb17-172"><a href="#cb17-172" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-173"><a href="#cb17-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-174"><a href="#cb17-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## Viewing Raw HTML from a website</span></span>
<span id="cb17-175"><a href="#cb17-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-176"><a href="#cb17-176" aria-hidden="true" tabindex="-1"></a>You can inspect the source code of any webpage by using a web browser like Firefox or Chrome. </span>
<span id="cb17-177"><a href="#cb17-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-178"><a href="#cb17-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On Firefox, navigate to the ‚ÄúTools‚Äù menu item in the top menu and click on ‚ÄúWeb Developer/Page Source‚Äù. You can also use the shortcut <span class="in">`Command + U`</span></span>
<span id="cb17-179"><a href="#cb17-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On Chrome, navigate to the top menu item ‚ÄúView‚Äù and click on ‚ÄúDeveloper/View Source.‚Äù You can also use the keyboard shortcut <span class="in">`Option-Command-U`</span>. It also can be useful to use the <span class="co">[</span><span class="ot">SelectorGadget Extension</span><span class="co">](https://chrome.google.com/webstore/detail/selectorgadget/mhjhnkcfbdhnjickkkdbjoemdmbfginb/related)</span>. </span>
<span id="cb17-180"><a href="#cb17-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-181"><a href="#cb17-181" aria-hidden="true" tabindex="-1"></a><span class="fu">## Webscraping Tables from Wikipedia</span></span>
<span id="cb17-182"><a href="#cb17-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-183"><a href="#cb17-183" aria-hidden="true" tabindex="-1"></a>Check out the information on the (List of the Most Viewed YouTube Videos on Wikipedia)<span class="co">[</span><span class="ot">https://en.wikipedia.org/wiki/List_of_most-viewed_YouTube_videos</span><span class="co">]</span>. </span>
<span id="cb17-184"><a href="#cb17-184" aria-hidden="true" tabindex="-1"></a>Suppose we want to scrape this data to use in R. </span>
<span id="cb17-185"><a href="#cb17-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-186"><a href="#cb17-186" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`read_html`</span> scrapes the raw html from the webpage as text</span>
<span id="cb17-187"><a href="#cb17-187" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`html_element`</span> (and <span class="in">`html_elements`</span>) selects particular elements from the HTML code</span>
<span id="cb17-188"><a href="#cb17-188" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`html_table`</span> formats a scraped html table as a tibble (R table)</span>
<span id="cb17-189"><a href="#cb17-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-190"><a href="#cb17-190" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb17-191"><a href="#cb17-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-192"><a href="#cb17-192" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb17-193"><a href="#cb17-193" aria-hidden="true" tabindex="-1"></a>youtube_videos <span class="ot">&lt;-</span> <span class="fu">read_html</span>(<span class="st">&quot;https://en.wikipedia.org/wiki/List_of_most-viewed_YouTube_videos&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-194"><a href="#cb17-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_element</span>(<span class="st">&quot;.wikitable&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-195"><a href="#cb17-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">html_table</span>() </span>
<span id="cb17-196"><a href="#cb17-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-197"><a href="#cb17-197" aria-hidden="true" tabindex="-1"></a>youtube_videos</span>
<span id="cb17-198"><a href="#cb17-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-199"><a href="#cb17-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-200"><a href="#cb17-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-201"><a href="#cb17-201" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We could have used <span class="in">`html_element(&quot;table&quot;)`</span></span>
<span id="cb17-202"><a href="#cb17-202" aria-hidden="true" tabindex="-1"></a>If we did this, it would have pulled the first <span class="in">`&lt;table&gt;`</span> from the page. </span>
<span id="cb17-203"><a href="#cb17-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-204"><a href="#cb17-204" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>We could have used <span class="in">`html_elements(&quot;table&quot;)`</span></span>
<span id="cb17-205"><a href="#cb17-205" aria-hidden="true" tabindex="-1"></a>If we did this, it would have pulled all the <span class="in">`&lt;table&gt;`</span> elements from the page. </span>
<span id="cb17-206"><a href="#cb17-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-207"><a href="#cb17-207" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If you want a specific table that isn&#39;t the first table, scrape all the tables and apply <span class="in">`html_table()`</span>. Then take that new object of the tables and add <span class="in">`[[n]]`</span> to get the $n^{th}$ table. For example to call the $2^{nd}$ table, </span>
<span id="cb17-208"><a href="#cb17-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-209"><a href="#cb17-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{}</span></span>
<span id="cb17-210"><a href="#cb17-210" aria-hidden="true" tabindex="-1"></a><span class="in">tables &lt;- html %&gt;% </span></span>
<span id="cb17-211"><a href="#cb17-211" aria-hidden="true" tabindex="-1"></a><span class="in">  html_elements(&quot;table&quot;) %&gt;%</span></span>
<span id="cb17-212"><a href="#cb17-212" aria-hidden="true" tabindex="-1"></a><span class="in">  html_table() </span></span>
<span id="cb17-213"><a href="#cb17-213" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb17-214"><a href="#cb17-214" aria-hidden="true" tabindex="-1"></a><span class="in">tables[[2]]</span></span>
<span id="cb17-215"><a href="#cb17-215" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-216"><a href="#cb17-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-217"><a href="#cb17-217" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>In this case, we used <span class="in">`html_elements(&quot;.wikitable&quot;)`</span></span>
<span id="cb17-218"><a href="#cb17-218" aria-hidden="true" tabindex="-1"></a>I choose to use this because the <span class="in">`&lt;table&gt;`</span> was also defined with a unique <span class="in">`class`</span>: <span class="in">`&lt;table class=&quot;wikitable sortable&quot;&gt;`</span></span>
<span id="cb17-219"><a href="#cb17-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-220"><a href="#cb17-220" aria-hidden="true" tabindex="-1"></a>:::callout-warning</span>
<span id="cb17-221"><a href="#cb17-221" aria-hidden="true" tabindex="-1"></a>Note that if we are using <span class="in">`html_element`</span> to call a class, it is important to add a &quot;<span class="in">`.`</span>&quot; before the class element name. You do not need to do this is you are calling an HTML element (like &quot;table&quot;)</span>
<span id="cb17-222"><a href="#cb17-222" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb17-223"><a href="#cb17-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-224"><a href="#cb17-224" aria-hidden="true" tabindex="-1"></a><span class="fu">## Cleaning up with `janitor`</span></span>
<span id="cb17-225"><a href="#cb17-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-226"><a href="#cb17-226" aria-hidden="true" tabindex="-1"></a>Web scraping doesn&#39;t always format perfectly. Let&#39;s clean it up!  </span>
<span id="cb17-227"><a href="#cb17-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-228"><a href="#cb17-228" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb17-229"><a href="#cb17-229" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb17-230"><a href="#cb17-230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-231"><a href="#cb17-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-232"><a href="#cb17-232" aria-hidden="true" tabindex="-1"></a><span class="al">![Artwork by @allisonhorst](https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/79a12c01-0cc1-4643-b1e7-8ce8cafc947b_rw_1920.png?h=a3760f3882e735d7065627fc060714ce)</span>{width=50%}</span>
<span id="cb17-233"><a href="#cb17-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-234"><a href="#cb17-234" aria-hidden="true" tabindex="-1"></a>Clean up the names of the header: </span>
<span id="cb17-235"><a href="#cb17-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{r warning=FALSE}</span></span>
<span id="cb17-236"><a href="#cb17-236" aria-hidden="true" tabindex="-1"></a>youtube_videos <span class="ot">&lt;-</span> <span class="fu">clean_names</span>(youtube_videos)</span>
<span id="cb17-237"><a href="#cb17-237" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-238"><a href="#cb17-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-239"><a href="#cb17-239" aria-hidden="true" tabindex="-1"></a>Remove the last row:</span>
<span id="cb17-240"><a href="#cb17-240" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb17-241"><a href="#cb17-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-242"><a href="#cb17-242" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb17-243"><a href="#cb17-243" aria-hidden="true" tabindex="-1"></a><span class="co"># youtube_videos &lt;- youtube_videos %&gt;% </span></span>
<span id="cb17-244"><a href="#cb17-244" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(no != &quot;As of August 8, 2023&quot;)</span></span>
<span id="cb17-245"><a href="#cb17-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-246"><a href="#cb17-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-247"><a href="#cb17-247" aria-hidden="true" tabindex="-1"></a>Format the views as a number using <span class="in">`as.numeric`</span>:</span>
<span id="cb17-248"><a href="#cb17-248" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb17-249"><a href="#cb17-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-250"><a href="#cb17-250" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb17-251"><a href="#cb17-251" aria-hidden="true" tabindex="-1"></a>youtube_videos <span class="ot">&lt;-</span> youtube_videos <span class="sc">%&gt;%</span> </span>
<span id="cb17-252"><a href="#cb17-252" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">views_billions =</span> <span class="fu">as.numeric</span>(views_billions))</span>
<span id="cb17-253"><a href="#cb17-253" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-254"><a href="#cb17-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-255"><a href="#cb17-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-256"><a href="#cb17-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-257"><a href="#cb17-257" aria-hidden="true" tabindex="-1"></a>What are the top 10 most viewed YouTube Videos? </span>
<span id="cb17-258"><a href="#cb17-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-259"><a href="#cb17-259" aria-hidden="true" tabindex="-1"></a>quarto-executable-code-5450563D</span>
<span id="cb17-260"><a href="#cb17-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-261"><a href="#cb17-261" aria-hidden="true" tabindex="-1"></a><span class="in">```r</span></span>
<span id="cb17-262"><a href="#cb17-262" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> youtube_videos <span class="sc">%&gt;%</span></span>
<span id="cb17-263"><a href="#cb17-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(views_billions)) <span class="sc">%&gt;%</span></span>
<span id="cb17-264"><a href="#cb17-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb17-265"><a href="#cb17-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-266"><a href="#cb17-266" aria-hidden="true" tabindex="-1"></a>top10</span>
<span id="cb17-267"><a href="#cb17-267" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-268"><a href="#cb17-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-269"><a href="#cb17-269" aria-hidden="true" tabindex="-1"></a>Once we have this data, we can make cool plots!</span>
<span id="cb17-270"><a href="#cb17-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-271"><a href="#cb17-271" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb17-272"><a href="#cb17-272" aria-hidden="true" tabindex="-1"></a>top10 <span class="sc">%&gt;%</span> </span>
<span id="cb17-273"><a href="#cb17-273" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>views_billions, <span class="at">y=</span><span class="fu">reorder</span>(video_name, views_billions))) <span class="sc">+</span></span>
<span id="cb17-274"><a href="#cb17-274" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-275"><a href="#cb17-275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Views (in billions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-276"><a href="#cb17-276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Videos&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-277"><a href="#cb17-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Top 10 Most Watched YouTube Videos of All Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-278"><a href="#cb17-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb17-279"><a href="#cb17-279" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-280"><a href="#cb17-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-281"><a href="#cb17-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-282"><a href="#cb17-282" aria-hidden="true" tabindex="-1"></a>:::callout-tip</span>
<span id="cb17-283"><a href="#cb17-283" aria-hidden="true" tabindex="-1"></a>In this case, the list of the names is still not displaying very neatly. For example, rather than <span class="in">`&quot;Baby Shark Dance&quot;[6]`</span> I might want it to just say <span class="in">`Baby Shark Dance`</span>. </span>
<span id="cb17-284"><a href="#cb17-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-285"><a href="#cb17-285" aria-hidden="true" tabindex="-1"></a>We can use the <span class="in">`stringr`</span> package to remove symbols and numbers from the video names. We will be talking more about <span class="in">`stringr`</span> later this semester and it&#39;s not something I expect you to be able to do at this point in the semester. </span>
<span id="cb17-286"><a href="#cb17-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-287"><a href="#cb17-287" aria-hidden="true" tabindex="-1"></a><span class="in">```{r message=FALSE, warning=FALSE}</span></span>
<span id="cb17-288"><a href="#cb17-288" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb17-289"><a href="#cb17-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-290"><a href="#cb17-290" aria-hidden="true" tabindex="-1"></a>top10 <span class="sc">%&gt;%</span> </span>
<span id="cb17-291"><a href="#cb17-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">video_name=</span><span class="fu">str_replace_all</span>(video_name, <span class="st">&quot;[^[:alpha:]]&quot;</span>, <span class="st">&quot; &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-292"><a href="#cb17-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>views_billions, <span class="at">y=</span><span class="fu">reorder</span>(video_name, views_billions))) <span class="sc">+</span></span>
<span id="cb17-293"><a href="#cb17-293" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-294"><a href="#cb17-294" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Views (in billions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-295"><a href="#cb17-295" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Videos&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-296"><a href="#cb17-296" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Top 10 Most Watched YouTube Videos of All Time&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-297"><a href="#cb17-297" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb17-298"><a href="#cb17-298" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb17-299"><a href="#cb17-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-300"><a href="#cb17-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-301"><a href="#cb17-301" aria-hidden="true" tabindex="-1"></a>:::callout</span>
<span id="cb17-302"><a href="#cb17-302" aria-hidden="true" tabindex="-1"></a><span class="fu"># External Resources</span></span>
<span id="cb17-303"><a href="#cb17-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-304"><a href="#cb17-304" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science, Webscraping</span><span class="co">](https://r4ds.hadley.nz/webscraping)</span></span>
<span id="cb17-305"><a href="#cb17-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-306"><a href="#cb17-306" aria-hidden="true" tabindex="-1"></a>:::</span></code></pre></div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id = "quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Handle positioning of the toggle
      window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->

</body>

</html>