{
  "hash": "f8ec72c8fda00dfe6cad4417ca7fc05d",
  "result": {
    "markdown": "---\ntitle: 'Joining tables with `dplyr`'\nauthor: 'Emily Malcolm-White'\nformat:\n  html: \n    toc: TRUE\n    code-overflow: wrap\n    embed-resources: true\n    code-tools:\n      source: true\n      toggle: false\n      caption: none\n    code-annotations: hover\n  pdf: default\nexecute: \n  message: FALSE\n  warning: FALSE\n---\n\n\n\n# `nycflights23` dataset \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#LOAD PACKAGES\nlibrary(tidyverse)\n\n#LOAD DATA\nlibrary(nycflights23)\ndata(\"flights\")\n```\n:::\n\n\n\n`nycflights23` contains information about all 435352 flights departing NYC in 2023. \n\n![](https://r4ds.hadley.nz/diagrams/relational.png)\n\n\n# Join dataframes\n\n## Matching key variable names\n\nSome airline names might be easy to guess (ie. \"UA\" is United Airlines), but what airlines have the code \"VX\", \"HA\", and \"B6\"? Data on airline codes is provided in a dataset called `airlines`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#data(\"airlines\")\n```\n:::\n\n\nWe want to have all this information in one data frame instead of two separate data frames. \n\nThe variable `carrier` in `flights` match the variable `carrier` in the `airlines` dataset -- this is our *key variable*. In this case, they have the same name, but this doesn't necessarily have to be true. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_joined <- flights %>% \n  inner_join(airlines, by=\"carrier\")\n```\n:::\n\n\n\n## Different key variable names\n\nSay instead you are interested in the destinations of all domestic flights departing NYC in 2013, and you ask yourself questions like: “What cities are these airports in?”, or “Is \"ORD\" Orlando?”\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"airports\")\n```\n:::\n\n\n\nIn `airports` the airport code is in `faa`, whereas in `flights` the airport codes are in `origin` and `dest`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_with_airport_names <- flights %>% \n  inner_join(airports, by = c(\"dest\" = \"faa\"))\n```\n:::\n\n\nLet’s construct the chain of pipe operators %>% that computes the number of flights from NYC to each destination, but also includes information about each destination airport:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnamed_dests <- flights %>%\n  group_by(dest) %>%\n  summarize(num_flights = n()) %>%\n  arrange(desc(num_flights)) %>%\n  inner_join(airports, by = c(\"dest\" = \"faa\")) %>%\n  rename(airport_name = name)\nnamed_dests\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 114 × 9\n   dest  num_flights airport_name             lat    lon   alt    tz dst   tzone\n   <chr>       <int> <chr>                  <dbl>  <dbl> <dbl> <dbl> <chr> <chr>\n 1 BOS         19036 General Edward Lawren…  42.4  -71.0    20    -5 A     Amer…\n 2 ORD         18200 Chicago O'Hare Intern…  42.0  -87.9   672    -6 A     Amer…\n 3 MCO         17756 Orlando International…  28.4  -81.3    96    -5 A     Amer…\n 4 ATL         17570 Hartsfield Jackson At…  33.6  -84.4  1026    -5 A     Amer…\n 5 MIA         16076 Miami International A…  25.8  -80.3     8    -5 A     Amer…\n 6 LAX         15968 Los Angeles Internati…  33.9 -118.    125    -8 A     Amer…\n 7 FLL         14239 Fort Lauderdale Holly…  26.1  -80.2     9    -5 A     Amer…\n 8 CLT         12866 Charlotte Douglas Int…  35.2  -80.9   748    -5 A     Amer…\n 9 DFW         11675 Dallas Fort Worth Int…  32.9  -97.0   607    -6 A     Amer…\n10 SFO         11651 San Francisco Interna…  37.6 -122.     13    -8 A     Amer…\n# ℹ 104 more rows\n```\n:::\n:::\n\n\n## Multiple Key variables\n\nIn order to join the flights and weather data frames, we need more than one key variable: `year`, `month`, `day`, `hour`, and `origin`. This is because the combination of these 5 variables act to uniquely identify each observational unit in the weather data frame: hourly weather recordings at each of the 3 NYC airports.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"weather\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_weather_joined <- flights %>%\n  inner_join(weather, by = c(\"year\", \"month\", \"day\", \"hour\", \"origin\"))\n```\n:::\n\n\n## Why is this useful? \n\nUpdating labels: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights %>% \nggplot(aes(x = carrier, fill = origin)) +\n  geom_bar() + \n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](118_I_joining_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#VS\n\nflights %>% \n  inner_join(airports, by = c(\"origin\" = \"faa\")) %>% \n  rename(origin_airport = name) %>% \n  inner_join(airlines, by = c(\"carrier\")) %>%  \n  rename(carrier_name= name) %>% \nggplot(mapping = aes(x = carrier_name, fill = origin_airport)) +\n  geom_bar() + \n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](118_I_joining_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n:::\n\n\n\nExploring relationships between variables in separate tables: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nflights_weather_joined %>% \n  filter(dep_delay >0) %>% \n  ggplot(aes(x=temp, y=dep_delay)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](118_I_joining_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n# Different Types of Joins\n\n![Credit: RStudio](http://rafalab.dfci.harvard.edu/dsbook/wrangling/img/joins.png)\n\n# Common Issues with Joining\n\n- duplicate keys\n- lowercase/uppercase\n- symbols or whitespace\n- Make sure the join fields are the same format.\n\n:::callout\n# External Resources\n\n- [R for Data Science, Joins](https://r4ds.hadley.nz/joins)\n\n:::\n\n",
    "supporting": [
      "118_I_joining_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}