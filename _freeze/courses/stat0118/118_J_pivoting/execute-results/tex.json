{
  "hash": "21e01ef17b9f862f82e808e67708d81c",
  "result": {
    "markdown": "---\ntitle: 'reshaping data with `tidyr`'\nauthor: 'Emily Malcolm-White'\nformat:\n  html: \n    toc: TRUE\n    code-overflow: wrap\n    embed-resources: true\n    code-tools:\n      source: true\n      toggle: false\n      caption: none\n    code-annotations: hover\n  pdf: default\nexecute: \n  message: FALSE\n  warning: FALSE\n---\n\n\n\n\n![](https://tidyr.tidyverse.org/logo.png){width=30%}\n\nThe goal of `tidyr` is to help you create tidy data. \n\n![Illustrations from the Openscapes blog Tidy Data for reproducibility, efficiency, and collaboration by Julia Lowndes and Allison Horst](https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/85520b8f-4629-4763-8a2a-9ceff27458bf_rw_1920.jpg?h=21007b20ac00cf37318dca645c215453)\n\n\n![https://r4ds.hadley.nz/data-tidy](https://r4ds.hadley.nz/images/tidy-1.png)\n\n# Reshaping with Pivoting -- Why? \n\nData frames are often described as wide or long. \n\n*Wide* when a row has more than one observation, and the units of observation are on one row each\n\n*Long* when a row has only one observation, but the units of observation are repeated down the column\n\n[Credit: datasciencebook.ca](https://github.com/UBC-DSCI/introduction-to-datascience/blob/main/img/wrangling/pivot_functions.001.jpeg?raw=true)\n\n![](https://datacarpentry.org/R-ecology-lesson/fig/tidyr-pivot_wider_longer.gif)\n\n# `portal` dataset \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#LOAD PACKAGES\nlibrary(tidyverse)\n\n#LOAD DATA\nportal_rodent <- read.csv(\"https://github.com/weecology/PortalData/raw/main/Rodents/Portal_rodent.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nportal_wgt_summary <- portal_rodent %>%\n  filter(!is.na(wgt)) %>%\n  group_by(plot, species) %>%\n  summarize(mean_wgt = mean(wgt))\n\nportal_wgt_summary\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 480 x 3\n# Groups:   plot [25]\n    plot species mean_wgt\n   <int> <chr>      <dbl>\n 1     1 BA          9.1 \n 2     1 DM         43.5 \n 3     1 DO         49.4 \n 4     1 DS        129.  \n 5     1 OL         33.2 \n 6     1 OT         24.3 \n 7     1 PB         32.0 \n 8     1 PE         22.3 \n 9     1 PF          7.12\n10     1 PH         31.4 \n# i 470 more rows\n```\n:::\n:::\n\n\n\n# Pivot Wider\n\n![](https://datacarpentry.org/R-ecology-lesson/fig/pivot_wider_graphic.png)\n\nPracticing transforming this data from long to wide format: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwide <- portal_wgt_summary %>% \n  pivot_wider(names_from = species, values_from = mean_wgt)\n\nwide\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 25 x 28\n# Groups:   plot [25]\n    plot    BA    DM    DO    DS    OL    OT    PB    PE    PF    PH    PI    PL\n   <int> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n 1     1  9.1   43.5  49.4  129.  33.2  24.3  32.0  22.3  7.12  31.4  17.4  25.2\n 2     2  9.4   43.4  49.1  123.  31.7  24.7  33.3  21.9  7.18  32.5  16    25.2\n 3     3  8.66  43.1  49.5  128.  31.0  23.6  32.6  22.5  7.58  28    17.1  22.2\n 4     4 10.2   43.5  49.2  118.  31.8  24.1  30.7  21.1  7.85  NA    18.4  NA  \n 5     5  9.14  43.8  49.8  111.  30.1  24.8  32.0  21.7  8.25  29    NA    24.6\n 6     6  9.33  42.6  48.8  114.  30.5  24.2  31.5  21.8  7.89  NA    17    25  \n 7     7 10     44.4  49.3  126.  32.2  24.4  33.4  23.1  9     30    NA    25.2\n 8     8 10.2   43.4  48.8  127.  28.8  23.9  30.2  21.6  7.06  41    19.8  28  \n 9     9 10.2   43.6  48.7  115.  30.4  23.6  30.0  21.6  7.22  NA    16.7  19  \n10    10 10     44.1  51.7  130   34.4  19.6  33.2  22.6  8     NA    NA    20.8\n# i 15 more rows\n# i 15 more variables: PM <dbl>, PP <dbl>, RM <dbl>, RO <dbl>, SF <dbl>,\n#   SH <dbl>, `NA` <dbl>, OX <dbl>, PX <dbl>, RF <dbl>, SO <dbl>, RX <dbl>,\n#   DX <dbl>, SS <dbl>, SX <dbl>\n```\n:::\n:::\n\n\n\n\n\n# Pivot Longer\n\n![](https://datacarpentry.org/R-ecology-lesson/fig/pivot_longer_graphic.png)\n\nPracticing transforming this data from wide to long format: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwide %>% \n  pivot_longer(names_to = \"species\", values_to = \"mean_wgt\", cols=2:28)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 675 x 3\n# Groups:   plot [25]\n    plot species mean_wgt\n   <int> <chr>      <dbl>\n 1     1 BA          9.1 \n 2     1 DM         43.5 \n 3     1 DO         49.4 \n 4     1 DS        129.  \n 5     1 OL         33.2 \n 6     1 OT         24.3 \n 7     1 PB         32.0 \n 8     1 PE         22.3 \n 9     1 PF          7.12\n10     1 PH         31.4 \n# i 665 more rows\n```\n:::\n\n```{.r .cell-code}\n# or cols = - plot_id\n```\n:::\n\n\n\n# Challenge\n\nReshape the rodents data frame with year as columns, plot as rows, and the number of species per plot as the values. You will need to summarize before reshaping, and use the function `n_distinct()` to get the number of unique species within a particular chunk of data. Itâ€™s a powerful function! See ?n_distinct for more.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nportal_rodent %>% \n  group_by(year, plot) %>% \n  summarize(unique_species = n_distinct(species)) %>% \n  pivot_wider(names_from = year, values_from = unique_species)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 25 x 50\n    plot `1977` `1978` `1979` `1980` `1981` `1982` `1983` `1984` `1985` `1986`\n   <int>  <int>  <int>  <int>  <int>  <int>  <int>  <int>  <int>  <int>  <int>\n 1     1      4      5      7      9      8      9     10      9      6      5\n 2     2      9      9      9     11      9     12     12     12     10      7\n 3     3      9      8      6      9      8     13     12     12      9      8\n 4     4      5      5      5      7      6      6      8      5      7      5\n 5     5      6      4      4      7      6      8      9     10      5      2\n 6     6      4      8      6      8      7     13     13     11      8      8\n 7     7      4      2      4      4      2      6      4      4      5      4\n 8     8      4      7      5      8      9     11      8      8      7      6\n 9     9      6      6      6      8      8      8     10      7      8      5\n10    10      3      1      4      7      8      9      5      3      4      2\n# i 15 more rows\n# i 39 more variables: `1987` <int>, `1988` <int>, `1989` <int>, `1990` <int>,\n#   `1991` <int>, `1992` <int>, `1993` <int>, `1994` <int>, `1995` <int>,\n#   `1996` <int>, `1997` <int>, `1998` <int>, `1999` <int>, `2000` <int>,\n#   `2001` <int>, `2002` <int>, `2003` <int>, `2004` <int>, `2005` <int>,\n#   `2006` <int>, `2007` <int>, `2008` <int>, `2009` <int>, `2010` <int>,\n#   `2011` <int>, `2012` <int>, `2013` <int>, `2014` <int>, `2015` <int>, ...\n```\n:::\n:::\n",
    "supporting": [
      "118_J_pivoting_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}