{
  "hash": "b150627f33c5622fd4a3e31053a42227",
  "result": {
    "markdown": "---\ntitle: 'STAT 118: Notes K'\nsubtitle: 'Maps with `maps` and `sf`'\nformat:\n  html:\n    toc: true\n    code-overflow: wrap\n---\n\n\n### Before we get started, some context:\n\n- `R` is ***fantastic*** for spacial analysis (not covered in this class... look for classes related to spacial statistics)\n- `R` is *great* for interactive data visualization (via `leaflet` or `shiny`... more on this on Thursday)\n- `R` is *okay* at spacial data visualization (creating maps).\n  - There are many different packages in `R` for creating maps. I've found that different packages perform best for different maps. We will talk about a few different ones today. \n  -  If you have a highly map-centric project, there is nothing wrong with working in ArcGIS or QGIS if you find the mapping tools in R insufficient. There are many recent improvements with new packages (like `sp`, `rgdal` and `rgeos`) which profiles much of the functionality of GIS packages! Exciting! (not very beginner friendly - requires familiarity with GIS concepts)\n\n# Using the `sf` package\n\nVector data for maps are typically encoded using the \"simple features\" standard produced by the Open Geospatial Consortium. The `sf` package developed by Edzer Pebesma provides an excellent toolset for working with such data, and the `geom_sf()` and `coord_sf()` functions in ggplot2 are designed to work together with the `sf` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#LOAD PACKAGES\nlibrary(tidyverse)\n\n#install.packages(\"sf\") - note some students are getting a pop-up when they install the sf package for the first time. Select the \"no\" option when it pops up in your console. \nlibrary(sf)\n\n#some students are needing into install the rgeos package seperately as well\n#library(rgeos)\n```\n:::\n\n\nFor our first example, we will be working with a dataset of North Carolina that is built in to the `sf` package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndemo(nc, ask = FALSE, echo = FALSE)\n```\n:::\n\n\nYou should notice that the `nc` dataset is now saved in your R environment. This dataset contains information about Sudden Infant Death Syndrome (SIDS) for North Carolina counties, over two time periods (1974-78 and 1979-84). Letâ€™s take a look at that dataset.\n\nEach row represents a county in North Carolina. This data frame contains the following columns:\n\n- `AREA` County polygon areas in degree units\n- `PERIMETER` County polygon perimeters in degree units\n- `CNTY_` Internal county ID\n- `NAME` County names\n- `FIPS` County ID\n- `FIPSNO` County ID\n- `CRESS_ID` Cressie papers ID\n- `BIR74` births, 1974-78\n- `SID74` SID deaths, 1974-78\n- `NWBIR74` non-white births, 1974-78\n- `BIR79` births, 1979-84\n- `SID79` SID deaths, 1979-84\n- `NWBIR79` non-white births, 1979-84\n- `geom` information needed to plot the map for each county\n\nLet's begin by simply plotting the map: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnc %>%\n  ggplot() +\n  geom_sf()\n```\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n\nLet's pretty it up: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nnc %>%\n  ggplot() +\n  geom_sf(col=\"black\", fill=\"darkgrey\") +\n  theme_light() +\n  ggtitle(\"North Carolina Counties\")\n```\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n# Cloropleth maps\n\nSuppose we want to shade each of these counties, based on the number of births in 1974. \n\nThis is called a \"cloropleth\" map (a map that uses differences in shading, coloring, or the placing of symbols within predefined areas to indicate the average values of a property or quantity in those areas). \n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap <- nc %>%\n  ggplot() +\n  geom_sf( aes(fill = BIR74), col =\"black\") +\n  theme_light()+\n  ggtitle(\"North Carolina, Birth Rates in 1974\")\n\nmap\n```\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n# Color Palettes\n\n\n::: {.cell}\n\n:::\n\n\n\n\n## Qualitative Color Palettes\n \n|  | |\n|-------------|----------------------------------|\n| **Best for...**    | Categories (unordered)   |\n| **Examples**       | Species, Groups, Brands  |\n| **`RColorBrewer` Palettes** | `\"Set1\"`, `\"Dark2\"`, `\"Paired\"` |\n| Example R Code | `scale_fill_brewer(palette = \"Set1\")` |\n| **`wesanderson` Palettes** | `\"GrandBudapest1\"`, `\"Darjeeling1\"`, `\"Moonrise2\"` |\n| Example R Code | `scale_fill_manual(values = wes_palette(\"GrandBudapest1\"))` |\n\n\n::: {.cell layout-ncol=\"2\" fig.ncol='2'}\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-7-2.png){width=672}\n:::\n:::\n\n\n\n## Sequential Color Palettes\n \n|  | |\n|-------------|----------------------------------|\n| **Best for...**    | Ordered, continuous data     |\n| **Examples**       | Temperature, Population Density |\n| **`RColorBrewer` Palettes** | `\"Blues\"`, `\"Reds\"`, `\"Greens\"` |\n| Example R Code| `scale_fill_brewer(palette = \"Blues\")` |\n| **`viridis` Palettes** | `\"viridis\"`, `\"magma\"`, `\"plasma\"`, `\"cividis\"` |\n| Example R Code | `scale_fill_viridis_c(option = \"magma\")` |\n| **Build your Own** | `scale_fill_gradientn(c(\"red\", \"yellow\"))`|\n\n\n::: {.cell layout-ncol=\"2\" fig.ncol='2'}\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::\n\n\n**Note**: Be sure that higher values are encoded with the darkest colors! \n\n\n## Diverging Color Palettes\n\n|  | |\n|-------------|----------------------------------|\n| **Best for...**    | Data with a central midpoint    |\n| **Examples**       | Election Results, Anomaly Detection |\n| **`RColorBrewer` Palettes** | `\"RdBu\"`, `\"Spectral\"` |\n| Example R Code | `scale_fill_brewer(palette = \"RdBu\")` |\n| **Build your Own** | `scale_fill_manual(values = c(\"red\", \"orange\"))` |\n\n\n::: {.cell layout-ncol=\"2\" fig.ncol='2'}\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-9-2.png){width=672}\n:::\n:::\n\n\n:::{.callout-tip}\n# Some general guidelines when choosing color palettes: \n\nâœ…  Match palette type to data type\n\nâœ… Choose colorblind-friendly palettes when designing for general audiences\n\nâœ… Limit colors to avoid overwhelming the reader - for categortical data limit the number of distinct colors to 5-8 max (beyond that, consider grouping)\n\nâœ… Consider the meaning of colors in your audienceâ€™s cultural context.\n\nðŸ”´ Avoid: Using blue for land in maps\n\n:::\n\n\n# Customizing Cholepleth maps \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(RColorBrewer)\n\nmap + \n  scale_fill_viridis_c(option = \"magma\", direction = -1) \n```\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n\n\n## Adding labels with `geom_sf_text()`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap + \n  scale_fill_viridis_c(option = \"magma\", direction = -1)+ \n  geom_sf_text(aes(label = NAME), size = 1)\n```\n\n::: {.cell-output-display}\n![](118_G_maps_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "118_G_maps_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}