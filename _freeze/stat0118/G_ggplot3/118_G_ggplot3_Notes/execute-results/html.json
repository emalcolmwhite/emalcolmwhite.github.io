{
  "hash": "6b898d411ac9229bce94e072e1ef7b4f",
  "result": {
    "markdown": "---\ntitle: 'STAT 118: Notes G'\nsubtitle: |\n  | Making plots  with `ggplot2`: working with numeric data using `scales`, labels, jitter\n  | ![](https://ggplot2.tidyverse.org/logo.png){width=10%}\nauthor: 'Emily Malcolm-White'\ninstitute: 'Middlebury College'\nformat:\n  html: \n    toc: TRUE\n    code-overflow: wrap\n    embed-resources: true\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n#Import the can_lang dataset \ncan_lang <- read.csv(\"https://raw.githubusercontent.com/ttimbers/canlang/master/inst/extdata/can_lang.csv\")\n```\n:::\n\n\n\n# scatterplot of `can_lang`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(can_lang, aes(x=most_at_home, y=mother_tongue)) +\n  geom_point() + \n  xlab(\"Language spoken most at home \\n (number of Canadian residents)\") +\n  ylab(\"Mother tongue \\n (number of Canadian residents)\") +\n  theme(text = element_text(size = 12))\n```\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nNotice anything weird about this plot? \n\n# Axis transformations using the `scales` package\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(scales)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(can_lang, aes(x = most_at_home, y = mother_tongue)) +\n  geom_point() +\n  xlab(\"Language spoken most at home \\n (number of Canadian residents)\") +\n  ylab(\"Mother tongue \\n (number of Canadian residents)\") +\n  theme(text = element_text(size = 12)) +\n  scale_x_log10(labels = label_comma()) +\n  scale_y_log10(labels = label_comma())\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Transformation introduced infinite values in continuous x-axis\n```\n:::\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n## `mutate` to create new columns\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncan_lang <- can_lang %>%\n  mutate(\n    mother_tongue_percent = (mother_tongue / 35151728) * 100,\n    most_at_home_percent = (most_at_home / 35151728) * 100\n  )\n```\n:::\n\n\n## Scatterplot with Percents and Colors\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(can_lang, aes(x = most_at_home_percent, \n                     y = mother_tongue_percent, \n                     color = category, shape=category)) +\n  geom_point() +\n  xlab(\"Language spoken most at home \\n (percentage of Canadian residents)\") +\n  ylab(\"Mother tongue \\n (percentage of Canadian residents)\") +\n  theme(text = element_text(size = 12),\n        legend.position = \"top\",\n        legend.direction = \"vertical\") +\n  scale_x_log10(labels = comma) +\n  scale_y_log10(labels = comma)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Transformation introduced infinite values in continuous x-axis\n```\n:::\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n# Labels\n\nAdding text to a plot is one of the most common forms of annotation. Most plots will not benefit from adding text to every single observation on the plot, but labeling outliers and other important points is very useful. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(can_lang, aes(x = most_at_home_percent, \n                     y = mother_tongue_percent, \n                     color = category, shape=category)) +\n  geom_point() +\n  xlab(\"Language spoken most at home \\n (percentage of Canadian residents)\") +\n  ylab(\"Mother tongue \\n (percentage of Canadian residents)\") +\n  theme(text = element_text(size = 12),\n        legend.position = \"top\",\n        legend.direction = \"vertical\") +\n  scale_x_log10(labels = comma) +\n  scale_y_log10(labels = comma) + \n  geom_text(aes(label=language), \n              nudge_x = 0.25, \n              nudge_y=0.25)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Transformation introduced infinite values in continuous x-axis\nTransformation introduced infinite values in continuous x-axis\n```\n:::\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nYikes! This is way too much going on in one plot. A few options to try when this happens: \n\n- Decrease the font size of the labels (using the `size=` argument inside `geom_text`).\n- Use the `ggrepel` package to spread out the labels a bit more (more on this later\n- Pick out only a subset of the points to label\n\n## Size of labels\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(can_lang, aes(x = most_at_home_percent, \n                     y = mother_tongue_percent, \n                     color = category, shape=category)) +\n  geom_point() +\n  xlab(\"Language spoken most at home \\n (percentage of Canadian residents)\") +\n  ylab(\"Mother tongue \\n (percentage of Canadian residents)\") +\n  theme(text = element_text(size = 12),\n        legend.position = \"top\",\n        legend.direction = \"vertical\") +\n  scale_x_log10(labels = comma) +\n  scale_y_log10(labels = comma) + \n  geom_text(aes(label=language), \n              nudge_x = 0.25, \n              nudge_y=0.25, size=3)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Transformation introduced infinite values in continuous x-axis\nTransformation introduced infinite values in continuous x-axis\n```\n:::\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n## Subset the labels\n\nCreate a new column for the labels. Use `case_when` (or `ifelse`) to only use the official language names and not to put a label for other language categories. \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncan_lang <- can_lang %>% \n  mutate(official_languages = case_when(category == \"Official languages\" ~ language, TRUE ~ NA ))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(can_lang, aes(x = most_at_home_percent, \n                     y = mother_tongue_percent, \n                     color = category, shape=category)) +\n  geom_point() +\n  xlab(\"Language spoken most at home \\n (percentage of Canadian residents)\") +\n  ylab(\"Mother tongue \\n (percentage of Canadian residents)\") +\n  theme(text = element_text(size = 12),\n        legend.position = \"top\",\n        legend.direction = \"vertical\") +\n  scale_x_log10(labels = comma) +\n  scale_y_log10(labels = comma) + \n  geom_text(aes(label=official_languages), \n              nudge_x = 0.25, \n              nudge_y=0.25, size = 3)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Transformation introduced infinite values in continuous x-axis\nTransformation introduced infinite values in continuous x-axis\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 212 rows containing missing values (`geom_text()`).\n```\n:::\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Using `ggrepel`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggrepel)\n```\n:::\n\n\n![Artwork by @allisonhorst](https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/874dedf0-55d1-4cdd-a390-45b8376d2fc2_rw_1920.png?h=39c69f525af3256f7096f510bafb0913){width=50%}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(can_lang, aes(x = most_at_home_percent, \n                     y = mother_tongue_percent, \n                     color = category, shape=category)) +\n  geom_point() +\n  xlab(\"Language spoken most at home \\n (percentage of Canadian residents)\") +\n  ylab(\"Mother tongue \\n (percentage of Canadian residents)\") +\n  theme(text = element_text(size = 12),\n        legend.position = \"top\",\n        legend.direction = \"vertical\") +\n  scale_x_log10(labels = comma) +\n  scale_y_log10(labels = comma) + \n  geom_text_repel(aes(label=official_languages), min.segment.length=0, box.padding=1)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Transformation introduced infinite values in continuous x-axis\nTransformation introduced infinite values in continuous x-axis\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 212 rows containing missing values (`geom_text_repel()`).\n```\n:::\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n# (Optional) Jitter\n\n\nThis dataset contains a subset of the fuel economy data that the EPA makes available on https://fueleconomy.gov/. It contains only models which had a new release every year between 1999 and 2008 - this was used as a proxy for the popularity of the car.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(\"mpg\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = mpg, aes(x = displ, y = hwy)) + \n  geom_point(aes(color = class)) +\n  ggtitle(\"Overlapping Points\")\n```\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\nNote how there is only a fixed number of values for the x-axis and a fixed number of values for the y-axis. It's possible that some points might be overlapping others! \n\n**Jittering** is a technique for adding random noise to data points that have identical values in a plot. It is a useful method for avoiding overplotting and making it easier to visualize the density of data points that are otherwise hidden behind each other.\n\nWe add `position=\"jitter\"` inside the `geom_point` layer: \n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = mpg, aes(x = displ, y = hwy)) + \n  geom_point(aes(color = class), position = \"jitter\", alpha=0.7) +\n  ggtitle(\"With jitter and alpha\")  +\n  xlab(\"Engine Displacement (in L)\") + \n  ylab(\"Fuel Efficiency (mpg)\") + \n  labs(caption = \"Source: Fuel Economy Data 1999 - 2008 www.fueleconomy.gov\")\n```\n\n::: {.cell-output-display}\n![](118_G_ggplot3_Notes_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n# Brain Break\n\nHans Rosling's famous lectures combine enormous quantities of public data with a sport's commentator's style to reveal the story of the world's past, present and future development.\n\n<iframe width=\"560\" height=\"315\" src=\"https://www.youtube.com/embed/jbkSRLYSojo?start=29\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen></iframe>\n\n\n",
    "supporting": [
      "118_G_ggplot3_Notes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}